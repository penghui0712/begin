function getParameter(e){var t=decodeURI(window.location.search),i=e.length,a=t.indexOf(e);if(-1==a)return"";a+=i+1;var s=t.indexOf("&",a);return-1==s?t.substring(a):t.substring(a,s)}function showLoginDialog(){if(0==$("#loginView").length){var e='<div class="modal fade" id="loginView" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-lg_cust"><div class="modal-lg_cust"><div><div class="dia_view"><div><button type="button" class="closec"data-dismiss="modal" aria-hidden="true"> &times; </button></div><div class="log_view"><div><span class="lspan">登录</span></div><div class="l_c"><input id="phone_number" type="text" class="ltext" placeholder="请输入手机号"/></div><div class="l_c1"><input id="pwd" type="password" class="ltext" placeholder="请输入密码"/></div><div class="l_c4"><a id="forgetPwd">忘记密码？</a></div><div class="l_c2"><a id="login_b" class="lsty">登录</a></div><div class="l_c3"><span>还没有账号？</span><a id="reg_btn">立即注册</a></div></div></div><img src="img_2/window.png" class="dialog_bg"></div></div> </div></div>';$("body").append(e),$("#reg_btn").click(function(){$("#loginView").modal("hide"),showReigsterDialog()}),$("#login_b").click(function(){var e=$("#phone_number").val(),t=$("#pwd").val(),i=function(){$("#loginView").modal("hide"),setLoginState(!0)};if(Utils.checkPhoneNumber(e)){if(!Utils.checkNotEmpty(t))return void Utils.alert("密码不能为空");var a={telephoneNumber:e,password:t};doPost("/site-app/http/app/user/login.do",a,i)}}),$("#forgetPwd").click(function(){$("#loginView").modal("hide"),forgetPwdView()})}$("#loginView").modal().css({})}function forgetPwdView(){if(0==$("#forgetView").length){var e='<div class="modal fade" id="forgetView" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-lg_cust"><div class="modal-lg_cust"><div><div class="dia_view"><div><button type="button" class="closec"data-dismiss="modal" aria-hidden="true"> &times; </button></div><div class="reg_view"><div><span class="lspan">找回密码</span></div><div class="l_c"><input id="forget_telephone" type="text" class="ltext" placeholder="请输入手机号"/></div><div class="l_c1"><div class="tcell"><div class="tcell_1"><input id="forget_code" type="text" class="ltext stext" placeholder="请输入验证码"/></div><div class="tcell_2"><a id="ffsyzm" class="lsty2">发送验证码</a></div></div></div><div class="l_c1"><input id="forget_password" type="password" class="ltext" placeholder="请输入新密码"/></div><div class="l_c1"><input id="forget_repassword" type="password" class="ltext" placeholder="再次输入密码"/></div><div class="l_c2"><a class="lsty" id="forget_btn">确定</a></div></div></div><img src="img_2/window.png" class="dialog_bg"></div></div> </div></div>';$("body").append(e),$("#ffsyzm").click(function(){var e=$("#forget_telephone").val();if(Utils.checkPhoneNumber(e)){if($("#ffsyzm").hasClass("disabled"))return!1;$("#forgetView").modal("hide"),showforgetValiDialog()}}),$("#forget_btn").click(function(){var e=$("#forget_telephone").val(),t=$("#forget_code").val(),i=$("#forget_password").val(),a=$("#forget_repassword").val();if(Utils.checkPhoneNumber(e)&&checkAuthCode(t)&&Utils.checkPassword(i)&&checkRepeatPassword(i,a)){var s=function(){$("#forgetView").modal("hide"),showSuccessDialog("修改成功")};doPost("/site-app/http/app/user/retrievePwd.do",{telephoneNumber:e,smsMsg:t,newPassword:i},s)}})}$("#forgetView").modal().css({})}function checkRepeatPassword(e,t){return e!=t?(Utils.alert("两次密码输入不一致"),!1):!0}function checkAuthCode(e){return null==e||6!=e.length?(Utils.alert("验证码长度为6位"),!1):!0}function setLoginState(e){islogin=e,e?($(".user_c").addClass("dbshow"),$(".login_i").removeClass("dbshow")):($(".user_c").removeClass("dbshow"),$(".login_i").addClass("dbshow"))}function showReigsterDialog(){if(0==$("#regView").length){var e='<div class="modal fade" id="regView" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-lg_cust"><div class="modal-lg_cust"><div><div class="dia_view"><div><button type="button" class="closec"data-dismiss="modal" aria-hidden="true"> &times; </button></div><div class="reg_view"><div><span class="lspan">注册</span></div><div class="l_c"><input id="register_telephone" type="text" class="ltext" placeholder="请输入手机号"/></div><div class="l_c1"><div class="tcell"><div class="tcell_1"><input id="register_code" type="text" class="ltext stext" placeholder="请输入验证码"/></div><div class="tcell_2"><a id="fsyzm" class="lsty2">发送验证码</a></div></div></div><div class="l_c1"><input id="register_password" type="password" class="ltext" placeholder="请输入密码"/></div><div class="l_c1"><input id="register_repassword" type="password" class="ltext" placeholder="再次输入密码"/></div><div class="l_c2"><a class="lsty" id="register_btn">注册并登录</a></div></div></div><img src="img_2/window.png" class="dialog_bg"></div></div> </div></div>';$("body").append(e),$("#fsyzm").click(function(){var e=$("#register_telephone").val();if(Utils.checkPhoneNumber(e)){if($("#fsyzm").hasClass("disabled"))return!1;$("#regView").modal("hide"),showValiDialog()}}),$("#register_btn").click(function(){var e=$("#register_telephone").val(),t=$("#register_code").val(),i=$("#register_password").val(),a=$("#register_repassword").val();if(Utils.checkPhoneNumber(e)&&checkAuthCode(t)&&Utils.checkPassword(i)&&checkRepeatPassword(i,a)){var s=function(){$("#regView").modal("hide"),showSuccessDialog("注册成功"),setLoginState(!0)};doPost("/site-app/http/app/user/register.do",{telephoneNumber:e,smsMsg:t,password:i},s)}})}$("#regView").modal().css({})}function showValiDialog(){if(0==$("#valid").length){var e='<div class="modal fade" id="valid" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-lg_cust"><div class="modal-lg_cust"><div><div class="dia_view"><div><button type="button" class="closec" id="close_b"> &times; </button></div><div class="log_view"><div><span class="lspan">请输入图形验证码</span></div><div class="vali_v"><div class=""><input id="validate_code" type="text" class="vtext" placeholder="请输入验证码"/></div><div><img id="vaimg" class="valiimg" src="/site-app/http/image/validate/drawRandom.do"></div></div><div class="l_c2"><a id="sure_b" class="phone_a_s">确定</a></div></div></div><img src="img_2/window.png" class="dialog_bg"></div></div> </div></div>';$("body").append(e),$("#sure_b").click(function(){var e=$("#validate_code").val();if(!Utils.checkNotEmpty(e))return void Utils.alert("请填写验证码");var t=function(){$("#valid").modal("hide"),showReigsterDialog(),sendFCode()};doPost("/site-app/http/app/user/validateCode.do",{randomCode:e},t)}),$("#close_b").click(function(){$("#valid").modal("hide"),showReigsterDialog()}),$("#vaimg").click(function(){$(this).attr("src","/site-app/http/image/validate/drawRandom.do?ran="+Math.random())})}$("#valid").modal().css({})}function showforgetValiDialog(){if(0==$("#forget_valid").length){var e='<div class="modal fade" id="forget_valid" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-lg_cust"><div class="modal-lg_cust"><div><div class="dia_view"><div><button type="button" class="closec" id="forget_close_b"> &times; </button></div><div class="log_view"><div><span class="lspan">请输入图形验证码</span></div><div class="vali_v"><div class=""><input id="forget_validate_code" type="text" class="vtext" placeholder="请输入验证码"/></div><div><img id="forget_vaimg" class="valiimg" src="/site-app/http/image/validate/drawRandom.do"></div></div><div class="l_c2"><a id="forget_sure_b" class="phone_a_s">确定</a></div></div></div><img src="img_2/window.png" class="dialog_bg"></div></div> </div></div>';$("body").append(e),$("#forget_sure_b").click(function(){var e=$("#forget_validate_code").val();if(!Utils.checkNotEmpty(e))return void Utils.alert("请填写验证码");var t=function(){$("#forget_valid").modal("hide"),forgetPwdView(),sendFFCode()};doPost("/site-app/http/app/user/validateCode.do",{randomCode:e},t)}),$("#forget_close_b").click(function(){$("#forget_valid").modal("hide"),forgetPwdView()}),$("#forget_vaimg").click(function(){$(this).attr("src","/site-app/http/image/validate/drawRandom.do?ran="+Math.random())})}$("#forget_valid").modal().css({})}function sendFCode(){var e=$("#register_telephone").val(),t=$("#validate_code").val(),i=$("#fsyzm");if(i.hasClass("disabled"))return!1;var a=function(){i.addClass("disabled");var e=60;i.html(e+"秒后重新发送");var t=setInterval(function(){return 0==e?(i.removeClass("disabled"),i.html("发送验证码"),e=60,void clearInterval(t)):(e--,void i.html(e+"秒后重新发送"))},1e3)};doPost("/site-app/http/app/user/sendSMS.do",{telephoneNumber:e,randomCode:t},a)}function sendFFCode(){var e=$("#forget_telephone").val(),t=$("#forget_validate_code").val(),i=$("#ffsyzm");if(i.hasClass("disabled"))return!1;var a=function(){i.addClass("disabled");var e=60;i.html(e+"秒后重新发送");var t=setInterval(function(){return 0==e?(i.removeClass("disabled"),i.html("发送验证码"),e=60,void clearInterval(t)):(e--,void i.html(e+"秒后重新发送"))},1e3)};doPost("/site-app/http/app/user/sendSMS.do",{telephoneNumber:e,randomCode:t},a)}function getLoginStatus(){var e=function(){setLoginState(!0)};doPost("/site-app/http/app/user/getLoginStatus.do?ran="+Math.random(),null,e)}function setLogout(){var e=function(){setLoginState(!1),showSuccessDialog("注销成功")};doPost("/site-app/http/app/user/logout.do",null,e)}function createTplView(e,t,i){var a=getTpl(e),s=juicer(a,i);$(t).html(s)}function doPost(e,t,i){function a(e){999==e.status,500==e.status&&alert(e.message),200==e.status&&i(e),201==e.status&&setLoginState(!1)}$.ajax({url:e,data:t,type:"POST",dataType:"json",async:!1,success:a})}function setLoginStatus(e){$.cookie("HBloginStatus",e,{expires:7})}function getLoginStatus(){return $.cookie("HBloginStatus")}function ajaxFileUpload(e,t){var i=$(e).val().substring($(e).val().lastIndexOf(".")+1,$(e).val().length),a=$(e).attr("id");return"png"!=i&&"jpg"!=i&&"jpeg"!=i?void alert("只能上传jpg，png，jpeg"):($.ajaxFileUpload({url:"/huoban-sales/http/sales/user/image/api/upload.do",secureuri:!1,fileElementId:a,type:"post",dataType:"json",success:function(e){200==e.status?t(e.data,a):alert(e.message)},error:function(){alert("上传失败")}}),!1)}var IMAGE_PATH="http://image.huoban.asia/";!function(){var e={};e.BadRequest=400,e.Unauthorized=401,e.RequestError=404,e.InternalError=500,window.ErrorCode=e}(),function(){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e}}(),function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=t);t>i;i++)if(i in this&&this[i]===e)return i;return-1})}(),function(){var e={},t=[];e.addListener=function(e){t.push(e)},e.post=function(e,i,a){for(var s=0;s<t.length;s++)null!=t[s].receiveMessage&&a!=t[s]&&t[s].receiveMessage(e,i)},window.MessageCenter=e}(),function(){var e={};e.getReqParams=function(e,t,i){var a=e,s=t,d=i,o={url:a,dataType:"json",type:d};return void 0==d&&(d="POST",o.type=d),o.data=JSON.stringify(s),o},e.getLoginUser=function(){return null==$.cookie("user_id")?null:{username:$.cookie("user_name"),userID:$.cookie("user_id"),login:!0}},e.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null},e.getLastPageUrl=function(){var e=document.referrer,t=document.domain;return e.indexOf("login")>=0||e.indexOf("register")>=0||e.indexOf("logout")>=0||e.indexOf("forgetpw")>=0?"/":e.indexOf(t)>=0?e:"/"},e.handleErrors=function(t,i,a){t.status==ErrorCode.Unauthorized&&(null==i||i.indexOf(ErrorCode.Unauthorized)>=0)&&(null==a||a.indexOf(ErrorCode.Unauthorized)<0)&&(window.location.href="/login.html"),t.status==ErrorCode.RequestError&&(null==i||i.indexOf(ErrorCode.RequestError)>=0)&&(null==a||a.indexOf(ErrorCode.RequestError)<0)&&e.alert(t.responseText),t.status==ErrorCode.InternalError&&(null==i||i.indexOf(ErrorCode.InternalError)>=0)&&(null==a||a.indexOf(ErrorCode.InternalError)<0)&&e.alert("服务器错误！")},e.checkPhoneNumber=function(t){var i=/^[1][0-9]{10}$/;return i.test(t)?!0:(e.alert("请输入正确的手机号"),!1)},e.checkPassword=function(t){var i=/^.{6,16}$/;return i.test(t)?!0:(e.alert("密码长度需要为6-16位"),!1)},e.checkNotEmpty=function(e){return null!=e&&e.length>0&&""!=e?!0:!1},e.checkNumber=function(t){var i=/^\d*$/;return i.test(t)?!0:(e.alert("请输入数字"),!1)},e.isMobileBrowser=function(){var e=navigator.userAgent.toLowerCase(),t=e.match(/(ipad).*os\s([\d_]+)/),i=!t&&e.match(/(iphone\sos)\s([\d_]+)/),a=e.match(/(android)\s+([\d.]+)/),s=i||a;return s},e.alert=function(e){alert(e)},e.alertNotOpen=function(){e.alert("亲，对不起，该功能还未开放，2016年初即将与您见面哦！但是您可以预先注册，领取新年活动首月免单优惠，或拨打400-999-8873获得最新活动资讯！")},e.createReservationDates=function(){var e=new Date,t=[];e.getHours()>=18&&(e=new Date(e.getTime()+864e5));for(var i=1;7>=i;i++){var a=new Date(e.getTime()+864e5*i);t.push(a)}return t},e.createReservationDates3=function(){var e=new Date,t=[];e.getHours()>=18&&(e=new Date(e.getTime()+864e5));for(var i=1;3>=i;i++){var a=new Date(e.getTime()+864e5*i);t.push(a)}return t},e.createReservationDays=function(){for(var e=[],t=30;720>=t;t+=30)e.push(t);return e},e.adjustElementVerticalCenter=function(e){var t=0,i=1e4;if(null!=e.attr("vcenter-container")){null!=$(e).attr("vcenter-min-width")&&(t=+$(e).attr("vcenter-min-width")),null!=$(e).attr("vcenter-max-width")&&(i=+$(e).attr("vcenter-max-width"));var a=document.body.clientWidth;if(!(a>=t&&i>=a))return void e.css("top",0);var s=$(e.attr("vcenter-container")),d=(s.height()-e.height())/2;return e.css("position","relavite"),e.css("top",d+"px"),s.height()>=e.height()}},window.Utils=e}();var islogin=!1;$(function(){var e=getParameter("channel");if(""!=e){document.cookie="channel='';expires=-1";var t=30,i=new Date;i.setTime(i.getTime()+24*t*60*60*1e3),document.cookie="channel="+e+";expires="+i.toGMTString()}});